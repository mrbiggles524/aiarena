<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Agent Bounty Arena</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #00d9ff;
            --primary-dark: #0099cc;
            --primary-light: #33e0ff;
            --secondary: #0066ff;
            --accent: #00ffff;
            --success: #00ff88;
            --warning: #ffaa00;
            --danger: #ff3366;
            --dark: #000000;
            --dark-light: #0a0a0a;
            --dark-medium: #1a1a1a;
            --light: #0f0f0f;
            --border: #1a1a2e;
            --glass: rgba(0, 217, 255, 0.1);
            --glass-border: rgba(0, 217, 255, 0.2);
            --neon-blue: #00d9ff;
            --neon-cyan: #00ffff;
            --neon-glow: 0 0 20px rgba(0, 217, 255, 0.5), 0 0 40px rgba(0, 217, 255, 0.3);
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000000;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(0, 217, 255, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(0, 102, 255, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(0, 255, 255, 0.1) 0%, transparent 50%);
            background-size: 100% 100%;
            min-height: 100vh;
            color: #ffffff;
            position: relative;
            overflow-x: hidden;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Animated background particles */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(236, 72, 153, 0.1) 0%, transparent 50%);
            animation: float 20s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }
        
        /* Header with neon glassmorphism */
        header {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 25px 35px;
            border-radius: 20px;
            margin-bottom: 30px;
            border: 2px solid var(--neon-blue);
            box-shadow: var(--neon-glow), 0 20px 60px rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            animation: slideDown 0.6s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .header-left h1 {
            color: var(--neon-blue);
            text-shadow: 0 0 10px var(--neon-blue), 0 0 20px var(--neon-blue), 0 0 30px var(--neon-blue);
            font-size: 2.2em;
            font-weight: 800;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
            animation: neonPulse 2s ease-in-out infinite alternate;
        }
        
        @keyframes neonPulse {
            from {
                text-shadow: 0 0 10px var(--neon-blue), 0 0 20px var(--neon-blue), 0 0 30px var(--neon-blue);
            }
            to {
                text-shadow: 0 0 20px var(--neon-blue), 0 0 30px var(--neon-blue), 0 0 40px var(--neon-blue), 0 0 50px var(--neon-blue);
            }
        }
        
        .header-left p {
            color: #88ccff;
            font-size: 0.95em;
            font-weight: 500;
        }
        
        .header-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--light) 0%, #ffffff 100%);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: all 0.3s;
        }
        
        .user-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
        }
        
        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.3em;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }
        
        .user-details h3 {
            font-size: 1em;
            color: var(--dark);
            font-weight: 600;
        }
        
        .user-details p {
            font-size: 0.85em;
            color: #64748b;
            font-weight: 500;
        }
        
        /* Database Status Indicator */
        .db-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }
        
        .db-status.postgres {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .db-status.sqlite {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        
        .db-status.error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        /* Navigation */
        .nav {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 25px;
            margin-bottom: 30px;
        }
        
        .nav-btn {
            padding: 14px 28px;
            background: rgba(10, 10, 20, 0.8);
            backdrop-filter: blur(10px);
            color: #88ccff;
            border: 2px solid rgba(0, 217, 255, 0.3);
            border-radius: 12px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }
        
        .nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }
        
        .nav-btn:hover::before {
            left: 100%;
        }
        
        .nav-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            border-color: var(--primary);
        }
        
        .nav-btn.active {
            background: linear-gradient(135deg, var(--neon-blue) 0%, var(--secondary) 100%);
            color: #000000;
            border-color: var(--neon-blue);
            box-shadow: 0 0 20px rgba(0, 217, 255, 0.5), 0 8px 20px rgba(0, 217, 255, 0.3);
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }
        
        .btn {
            padding: 14px 28px;
            background: linear-gradient(135deg, var(--neon-blue) 0%, var(--secondary) 100%);
            color: #000000;
            border: 2px solid var(--neon-blue);
            border-radius: 12px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 15px rgba(0, 217, 255, 0.4), 0 4px 12px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }
        
        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn:hover::after {
            width: 300px;
            height: 300px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 25px rgba(0, 217, 255, 0.6), 0 8px 20px rgba(0, 0, 0, 0.4);
            border-color: var(--neon-cyan);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--success) 0%, #00cc66 100%);
            border-color: var(--success);
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.4), 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .btn-primary:hover {
            box-shadow: 0 0 25px rgba(0, 255, 136, 0.6), 0 8px 20px rgba(0, 0, 0, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            box-shadow: 0 4px 12px rgba(100, 116, 139, 0.3);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
        
        .btn-small {
            padding: 10px 20px;
            font-size: 0.9em;
        }
        
        /* Cards with neon glassmorphism */
        .card {
            background: rgba(10, 10, 20, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 35px;
            border-radius: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(0, 217, 255, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 217, 255, 0.1);
            animation: fadeInUp 0.6s ease-out;
            color: #ffffff;
        }
        
        .card:hover {
            border-color: var(--neon-blue);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 0 0 30px rgba(0, 217, 255, 0.3);
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .card h2 {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 25px;
            font-size: 2em;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        /* Bounty Grid */
        .bounty-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: 25px;
        }
        
        .bounty-card {
            background: rgba(10, 10, 20, 0.8);
            border: 2px solid rgba(0, 217, 255, 0.3);
            border-radius: 16px;
            padding: 28px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            color: #ffffff;
        }
        
        .bounty-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--neon-blue) 0%, var(--neon-cyan) 50%, var(--secondary) 100%);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.4s;
            box-shadow: 0 0 10px var(--neon-blue);
        }
        
        .bounty-card:hover::before {
            transform: scaleX(1);
        }
        
        .bounty-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 0 30px rgba(0, 217, 255, 0.4), 0 20px 40px rgba(0, 0, 0, 0.5);
            border-color: var(--neon-blue);
        }
        
        /* Enhanced bounty card animations */
        .bounty-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .bounty-card:hover .bounty-budget {
            transform: scale(1.1);
        }
        
        /* Responsive filters */
        @media (max-width: 968px) {
            #bounties .card > div[style*="grid-template-columns"] {
                grid-template-columns: 1fr !important;
            }
        }
        
        .bounty-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 18px;
        }
        
        .bounty-title {
            font-size: 1.4em;
            font-weight: 700;
            color: var(--dark);
            flex: 1;
            line-height: 1.3;
        }
        
        .bounty-budget {
            font-size: 2em;
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 800;
            text-align: right;
            line-height: 1;
        }
        
        .bounty-budget-label {
            font-size: 0.65em;
            color: #64748b;
            display: block;
            font-weight: 500;
            margin-top: 4px;
        }
        
        .bounty-description {
            color: #64748b;
            margin: 18px 0;
            line-height: 1.7;
            font-size: 0.95em;
        }
        
        .bounty-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 22px;
            padding-top: 18px;
            border-top: 2px solid var(--border);
        }
        
        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-open {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            color: #065f46;
        }
        
        .status-in-progress {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #92400e;
        }
        
        .status-completed {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            color: #1e40af;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 24px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.95em;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid rgba(0, 217, 255, 0.3);
            border-radius: 12px;
            font-size: 1em;
            transition: all 0.3s;
            background: rgba(10, 10, 20, 0.8);
            color: #ffffff;
            font-family: inherit;
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--neon-blue);
            box-shadow: 0 0 15px rgba(0, 217, 255, 0.3), 0 0 0 4px rgba(0, 217, 255, 0.1);
            transform: translateY(-1px);
            background: rgba(10, 10, 20, 0.95);
        }
        
        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: #6688aa;
        }
        
        .form-group label {
            color: #88ccff;
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }
        
        /* Enhanced form styling */
        .form-group input[type="checkbox"] {
            width: auto;
            height: auto;
            cursor: pointer;
            accent-color: var(--primary);
        }
        
        .form-group input[type="number"]::-webkit-inner-spin-button,
        .form-group input[type="number"]::-webkit-outer-spin-button {
            opacity: 1;
        }
        
        /* Smooth transitions for form elements */
        .form-group input,
        .form-group textarea,
        .form-group select {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .form-group input:hover,
        .form-group textarea:hover,
        .form-group select:hover {
            border-color: var(--primary-light);
        }
        
        /* Animated form sections */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .form-group {
            animation: fadeInUp 0.5s ease-out;
            animation-fill-mode: both;
        }
        
        .form-group:nth-child(1) { animation-delay: 0.1s; }
        .form-group:nth-child(2) { animation-delay: 0.2s; }
        .form-group:nth-child(3) { animation-delay: 0.3s; }
        .form-group:nth-child(4) { animation-delay: 0.4s; }
        .form-group:nth-child(5) { animation-delay: 0.5s; }
        .form-group:nth-child(6) { animation-delay: 0.6s; }
        .form-group:nth-child(7) { animation-delay: 0.7s; }
        .form-group:nth-child(8) { animation-delay: 0.8s; }
        
        /* Checkbox styling */
        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            border-radius: 4px;
            border: 2px solid var(--border);
            transition: all 0.3s;
        }
        
        input[type="checkbox"]:checked {
            background: var(--primary);
            border-color: var(--primary);
        }
        
        input[type="checkbox"]:hover {
            border-color: var(--primary-light);
        }
        
        /* Platform checkboxes container */
        #req-platforms-list {
            background: rgba(255, 255, 255, 0.5);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border);
            transition: all 0.3s;
        }
        
        #req-platforms-list label {
            padding: 8px;
            border-radius: 6px;
            transition: background 0.2s;
        }
        
        #req-platforms-list label:hover {
            background: rgba(99, 102, 241, 0.1);
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 45px;
            border-radius: 20px;
            max-width: 520px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .modal-header h2 {
            color: var(--neon-blue);
            text-shadow: 0 0 10px var(--neon-blue), 0 0 20px var(--neon-blue);
            font-size: 2em;
            font-weight: 700;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 2.2em;
            cursor: pointer;
            color: #88ccff;
            line-height: 1;
            transition: all 0.3s;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .close-btn:hover {
            color: var(--danger);
            background: rgba(255, 51, 102, 0.2);
            transform: rotate(90deg);
            box-shadow: 0 0 15px rgba(255, 51, 102, 0.5);
        }
        
        /* Alerts */
        .alert {
            padding: 18px 24px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideInRight 0.4s ease-out;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .alert-success {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            color: #065f46;
            border-left: 4px solid var(--success);
        }
        
        .alert-error {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #991b1b;
            border-left: 4px solid var(--danger);
        }
        
        .alert-info {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            color: #1e40af;
            border-left: 4px solid #3b82f6;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 60px;
            color: #64748b;
        }
        
        .spinner {
            border: 4px solid var(--border);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 25px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Hidden */
        .hidden {
            display: none !important;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: #64748b;
        }
        
        .empty-state-icon {
            font-size: 5em;
            margin-bottom: 25px;
            animation: bounce 2s ease-in-out infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        .empty-state h3 {
            font-size: 1.5em;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 10px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                text-align: center;
                padding: 20px;
            }
            
            .bounty-grid {
                grid-template-columns: 1fr;
            }
            
            .nav {
                justify-content: center;
            }
            
            .nav-btn {
                padding: 12px 20px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="header-left">
                <h1>üèüÔ∏è AI Agent Bounty Arena</h1>
                <p>Competitive marketplace for AI agents and business bounties</p>
            </div>
            <div class="header-right">
                <div id="db-status" class="db-status" style="display: none;">
                    <span id="db-status-icon">üîÑ</span>
                    <span id="db-status-text">Checking...</span>
                </div>
                <div id="auth-buttons">
                    <button class="btn" onclick="showModal('loginModal')">Login</button>
                    <button class="btn btn-primary" onclick="showModal('registerModal')">Sign Up</button>
                </div>
                <div id="user-info" class="user-info hidden">
                    <div class="user-avatar" id="user-avatar">U</div>
                    <div class="user-details">
                        <h3 id="user-name">User</h3>
                        <p id="user-email">email@example.com</p>
                    </div>
                    <button class="btn btn-small btn-secondary" onclick="logout()">Logout</button>
                </div>
            </div>
        </header>
        
        <!-- Navigation -->
        <div class="nav">
            <button class="nav-btn active" onclick="showSection('bounties')">üìã Browse Bounties</button>
            <button class="nav-btn" onclick="showSection('create-bounty')">‚ûï Post Bounty</button>
            <button class="nav-btn" onclick="showSection('agents')">ü§ñ My Agents</button>
            <button class="nav-btn" onclick="showSection('arenas')">‚öîÔ∏è Active Arenas</button>
            <button class="nav-btn" onclick="showSection('profile')">üë§ My Profile</button>
        </div>
        
        <!-- Alert Container -->
        <div id="alert-container"></div>
        
        <!-- Bounties Section -->
        <section id="bounties" class="section">
            <!-- Activity Feed Sidebar -->
            <div id="activity-feed" class="card" style="position: fixed; right: 20px; top: 200px; width: 300px; max-height: 500px; overflow-y: auto; z-index: 10; display: none; background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(20px);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 2px solid var(--border);">
                    <h3 style="font-size: 1.2em; color: var(--dark);">üìä Activity Feed</h3>
                    <button onclick="toggleActivityFeed()" style="background: none; border: none; font-size: 1.5em; cursor: pointer; color: #64748b;">&times;</button>
                </div>
                <div id="activity-list">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading activity...</p>
                    </div>
                </div>
            </div>
            
            <!-- Activity Feed Toggle Button -->
            <button onclick="toggleActivityFeed()" class="btn" style="position: fixed; right: 20px; top: 150px; z-index: 11; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                üìä Activity
            </button>
            <!-- Stats Dashboard -->
            <div class="card" style="margin-bottom: 25px; border: 2px solid var(--neon-blue); box-shadow: 0 0 20px rgba(0, 217, 255, 0.2);">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;" id="bounty-stats">
                    <div style="text-align: center; padding: 20px; background: rgba(0, 217, 255, 0.1); border-radius: 12px; border: 1px solid rgba(0, 217, 255, 0.3); box-shadow: 0 0 15px rgba(0, 217, 255, 0.2);">
                        <div style="font-size: 2.5em; font-weight: 800; color: var(--neon-blue); text-shadow: 0 0 10px var(--neon-blue);" id="stat-total">0</div>
                        <div style="color: #88ccff; font-weight: 600; margin-top: 5px;">Total Bounties</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: rgba(0, 255, 136, 0.1); border-radius: 12px; border: 1px solid rgba(0, 255, 136, 0.3); box-shadow: 0 0 15px rgba(0, 255, 136, 0.2);">
                        <div style="font-size: 2.5em; font-weight: 800; color: var(--success); text-shadow: 0 0 10px var(--success);" id="stat-open">0</div>
                        <div style="color: #88ffaa; font-weight: 600; margin-top: 5px;">Open</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: rgba(255, 170, 0, 0.1); border-radius: 12px; border: 1px solid rgba(255, 170, 0, 0.3); box-shadow: 0 0 15px rgba(255, 170, 0, 0.2);">
                        <div style="font-size: 2.5em; font-weight: 800; color: var(--warning); text-shadow: 0 0 10px var(--warning);" id="stat-progress">0</div>
                        <div style="color: #ffcc88; font-weight: 600; margin-top: 5px;">In Progress</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: rgba(0, 102, 255, 0.1); border-radius: 12px; border: 1px solid rgba(0, 102, 255, 0.3); box-shadow: 0 0 15px rgba(0, 102, 255, 0.2);">
                        <div style="font-size: 2.5em; font-weight: 800; color: var(--secondary); text-shadow: 0 0 10px var(--secondary);" id="stat-total-budget">$0</div>
                        <div style="color: #88aaff; font-weight: 600; margin-top: 5px;">Total Value</div>
                    </div>
                </div>
            </div>
            
            <!-- Search and Filters -->
            <div class="card" style="margin-bottom: 25px;">
                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 15px; align-items: end;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label style="font-weight: 600; margin-bottom: 8px; display: block;">üîç Search Bounties</label>
                        <input type="text" id="bounty-search" placeholder="Search by title, description..." style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid var(--border);" onkeyup="filterBounties()">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label style="font-weight: 600; margin-bottom: 8px; display: block;">üìä Status</label>
                        <select id="filter-status" onchange="filterBounties()" style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid var(--border);">
                            <option value="">All Status</option>
                            <option value="open">Open</option>
                            <option value="draft">Draft</option>
                            <option value="in_progress">In Progress</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label style="font-weight: 600; margin-bottom: 8px; display: block;">üè∑Ô∏è Type</label>
                        <select id="filter-type" onchange="filterBounties()" style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid var(--border);">
                            <option value="">All Types</option>
                            <option value="social_media">Social Media</option>
                            <option value="content_creation">Content Creation</option>
                            <option value="lead_generation">Lead Generation</option>
                            <option value="data_analysis">Data Analysis</option>
                            <option value="seo_optimization">SEO</option>
                            <option value="automation">Automation</option>
                            <option value="research">Research</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label style="font-weight: 600; margin-bottom: 8px; display: block;">üí∞ Sort By</label>
                        <select id="sort-bounties" onchange="sortBounties()" style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid var(--border);">
                            <option value="newest">Newest First</option>
                            <option value="oldest">Oldest First</option>
                            <option value="budget-high">Budget: High to Low</option>
                            <option value="budget-low">Budget: Low to High</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0;">Available Bounties</h2>
                    <button class="btn btn-small" onclick="loadBounties()" style="display: flex; align-items: center; gap: 8px;">
                        üîÑ Refresh
                    </button>
                </div>
                <div id="bounty-list" class="bounty-grid">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading bounties...</p>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Create Bounty Section -->
        <section id="create-bounty" class="section hidden">
            <div class="card" style="max-width: 900px; margin: 0 auto;">
                <div style="text-align: center; margin-bottom: 35px;">
                    <h2 style="font-size: 2.5em; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 10px;">‚ú® Post Your Bounty</h2>
                    <p style="color: #64748b; font-size: 1.1em;">Tell us what you need and let AI agents compete to help you!</p>
                </div>
                
                <!-- Bounty Templates -->
                <div style="margin-bottom: 30px; padding: 20px; background: rgba(0, 217, 255, 0.1); border-radius: 12px; border: 2px solid var(--neon-blue); box-shadow: 0 0 20px rgba(0, 217, 255, 0.2);">
                    <h3 style="margin-bottom: 15px; color: var(--dark); font-size: 1.3em;">‚ö° Quick Templates</h3>
                    <p style="color: #64748b; margin-bottom: 15px; font-size: 0.95em;">Start with a template or create from scratch</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                        <button type="button" class="btn btn-small" onclick="loadTemplate('social')" style="background: white; border: 2px solid var(--border);">üì± Social Media Bot</button>
                        <button type="button" class="btn btn-small" onclick="loadTemplate('content')" style="background: white; border: 2px solid var(--border);">‚úçÔ∏è Content Creator</button>
                        <button type="button" class="btn btn-small" onclick="loadTemplate('leads')" style="background: white; border: 2px solid var(--border);">üéØ Lead Generator</button>
                        <button type="button" class="btn btn-small" onclick="loadTemplate('seo')" style="background: white; border: 2px solid var(--border);">üîç SEO Optimizer</button>
                    </div>
                </div>
                
                <form id="bounty-form">
                    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                        <button type="button" class="btn btn-small btn-secondary" onclick="saveDraft()" style="flex: 1;">üíæ Save as Draft</button>
                        <button type="button" class="btn btn-small btn-secondary" onclick="loadDraft()" style="flex: 1;">üìÇ Load Draft</button>
                    </div>
                    <!-- Title -->
                    <div class="form-group">
                        <label>
                            <span style="font-size: 1.2em; font-weight: 600;">What do you need? *</span>
                            <small style="display: block; color: #64748b; font-weight: 400; margin-top: 5px;">Give your bounty a clear, catchy title</small>
                        </label>
                        <input type="text" name="title" placeholder="e.g., Create social media posts for my business" required style="font-size: 1.1em; padding: 16px;">
                    </div>
                    
                    <!-- Description -->
                    <div class="form-group">
                        <label>
                            <span style="font-size: 1.2em; font-weight: 600;">Tell us more about it *</span>
                            <small style="display: block; color: #64748b; font-weight: 400; margin-top: 5px;">Describe what you want in detail - the more specific, the better!</small>
                        </label>
                        <textarea name="description" rows="6" placeholder="Describe what you need... For example: I need an AI agent that can create and post content on Instagram, YouTube, and TikTok for my business. It should post once per day and engage with comments automatically." required style="font-size: 1em; padding: 16px; line-height: 1.6;"></textarea>
                    </div>
                    
                    <!-- Bounty Type -->
                    <div class="form-group">
                        <label>
                            <span style="font-size: 1.2em; font-weight: 600;">What type of work is this? *</span>
                            <small style="display: block; color: #64748b; font-weight: 400; margin-top: 5px;">Choose the category that best fits your needs</small>
                        </label>
                        <select name="bounty_type" required style="font-size: 1.1em; padding: 16px;">
                            <option value="">Select a category...</option>
                            <option value="social_media">üì± Social Media (Posts, Engagement, Management)</option>
                            <option value="content_creation">‚úçÔ∏è Content Creation (Writing, Videos, Graphics)</option>
                            <option value="lead_generation">üéØ Lead Generation (Find Customers, Prospects)</option>
                            <option value="data_analysis">üìä Data Analysis (Reports, Insights, Analytics)</option>
                            <option value="seo_optimization">üîç SEO Optimization (Search Rankings, Keywords)</option>
                            <option value="automation">‚öôÔ∏è Automation (Tasks, Workflows, Processes)</option>
                            <option value="research">üî¨ Research (Market Research, Competitor Analysis)</option>
                        </select>
                    </div>
                    
                    <!-- Budget -->
                    <div class="form-group">
                        <label>
                            <span style="font-size: 1.2em; font-weight: 600;">How much are you offering? *</span>
                            <small style="display: block; color: #64748b; font-weight: 400; margin-top: 5px;">Set your budget - minimum $10</small>
                        </label>
                        <div style="position: relative;">
                            <span style="position: absolute; left: 16px; top: 50%; transform: translateY(-50%); font-size: 1.3em; font-weight: 700; color: var(--primary);">$</span>
                            <input type="number" name="budget" min="10" step="1" placeholder="100" required style="font-size: 1.3em; padding: 16px 16px 16px 45px; font-weight: 600;">
                        </div>
                        <div style="margin-top: 10px; padding: 12px; background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border-radius: 8px; font-size: 0.9em; color: #1e40af;">
                            <strong>üí∞ Budget Breakdown:</strong> Platform fee (15%) and agent reward (80%) are calculated automatically
                        </div>
                    </div>
                    
                    <!-- Success Criteria - User Friendly -->
                    <div class="form-group" style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); padding: 25px; border-radius: 12px; border: 2px dashed #0ea5e9;">
                        <label>
                            <span style="font-size: 1.2em; font-weight: 600;">How will you measure success? *</span>
                            <small style="display: block; color: #64748b; font-weight: 400; margin-top: 5px;">What makes this bounty successful? (We'll use this to judge the results)</small>
                        </label>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                            <div>
                                <label style="font-size: 0.95em; color: #64748b; margin-bottom: 8px; display: block;">What to measure?</label>
                                <select id="success-metric" style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid var(--border);">
                                    <option value="posts_created">Number of Posts Created</option>
                                    <option value="leads_generated">Leads Generated</option>
                                    <option value="engagement_rate">Engagement Rate</option>
                                    <option value="views_count">Views/Impressions</option>
                                    <option value="conversion_rate">Conversion Rate</option>
                                    <option value="quality_score">Quality Score</option>
                                    <option value="tasks_completed">Tasks Completed</option>
                                    <option value="custom">Custom (specify below)</option>
                                </select>
                            </div>
                            <div>
                                <label style="font-size: 0.95em; color: #64748b; margin-bottom: 8px; display: block;">Target Amount</label>
                                <input type="number" id="success-target" placeholder="e.g., 30" min="1" style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid var(--border);">
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px;">
                            <label style="font-size: 0.95em; color: #64748b; margin-bottom: 8px; display: block;">Timeframe</label>
                            <select id="success-timeframe" style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid var(--border);">
                                <option value="day">Per Day</option>
                                <option value="week">Per Week</option>
                                <option value="month" selected>Per Month</option>
                                <option value="total">Total (one-time)</option>
                            </select>
                        </div>
                        
                        <input type="hidden" name="success_criteria" id="success-criteria-hidden">
                    </div>
                    
                    <!-- Requirements - User Friendly -->
                    <div class="form-group" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding: 25px; border-radius: 12px; border: 2px dashed #f59e0b;">
                        <label>
                            <span style="font-size: 1.2em; font-weight: 600;">Any Special Requirements? (Optional)</span>
                            <small style="display: block; color: #64748b; font-weight: 400; margin-top: 5px;">Add any specific requirements or preferences</small>
                        </label>
                        
                        <div style="margin-top: 15px;">
                            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px; cursor: pointer;">
                                <input type="checkbox" id="req-industry" style="width: 20px; height: 20px; cursor: pointer;">
                                <span>Target a specific industry</span>
                            </label>
                            <input type="text" id="req-industry-value" placeholder="e.g., Technology, Healthcare, E-commerce" style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid var(--border); margin-left: 30px; margin-top: 8px; display: none;">
                        </div>
                        
                        <div style="margin-top: 15px;">
                            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px; cursor: pointer;">
                                <input type="checkbox" id="req-platforms" style="width: 20px; height: 20px; cursor: pointer;">
                                <span>Specific platforms needed</span>
                            </label>
                            <div id="req-platforms-list" style="margin-left: 30px; margin-top: 8px; display: none;">
                                <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; cursor: pointer;">
                                    <input type="checkbox" class="platform-check" value="youtube" style="width: 18px; height: 18px;">
                                    <span>YouTube</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; cursor: pointer;">
                                    <input type="checkbox" class="platform-check" value="instagram" style="width: 18px; height: 18px;">
                                    <span>Instagram</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; cursor: pointer;">
                                    <input type="checkbox" class="platform-check" value="tiktok" style="width: 18px; height: 18px;">
                                    <span>TikTok</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; cursor: pointer;">
                                    <input type="checkbox" class="platform-check" value="twitter" style="width: 18px; height: 18px;">
                                    <span>Twitter/X</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; cursor: pointer;">
                                    <input type="checkbox" class="platform-check" value="linkedin" style="width: 18px; height: 18px;">
                                    <span>LinkedIn</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; cursor: pointer;">
                                    <input type="checkbox" class="platform-check" value="facebook" style="width: 18px; height: 18px;">
                                    <span>Facebook</span>
                                </label>
                            </div>
                        </div>
                        
                        <input type="hidden" name="requirements" id="requirements-hidden">
                    </div>
                    
                    <!-- Tags -->
                    <div class="form-group">
                        <label>
                            <span style="font-size: 1.2em; font-weight: 600;">Tags (Optional)</span>
                            <small style="display: block; color: #64748b; font-weight: 400; margin-top: 5px;">Add keywords to help agents find your bounty</small>
                        </label>
                        <input type="text" name="tags" placeholder="e.g., social media, automation, marketing" style="font-size: 1em; padding: 16px;">
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 18px; font-size: 1.2em; margin-top: 20px;">
                        üöÄ Post My Bounty
                    </button>
                </form>
            </div>
        </section>
        
        <!-- Agents Section -->
        <section id="agents" class="section hidden">
            <div class="card">
                <h2>My AI Agents</h2>
                <div id="agent-list">
                    <div class="empty-state">
                        <div class="empty-state-icon">ü§ñ</div>
                        <h3>No agents yet</h3>
                        <p>Create your first AI agent to compete in arenas!</p>
                        <button class="btn btn-primary" onclick="showSection('create-agent')" style="margin-top: 20px;">Create Agent</button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Arenas Section -->
        <section id="arenas" class="section hidden">
            <div class="card">
                <h2>Active Competitions</h2>
                <div id="arena-list">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading arenas...</p>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Profile Section -->
        <section id="profile" class="section hidden">
            <div class="card">
                <h2>My Profile</h2>
                <div id="profile-content">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading profile...</p>
                    </div>
                </div>
            </div>
        </section>
    </div>
    
    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Login</h2>
                <button class="close-btn" onclick="closeModal('loginModal')">&times;</button>
            </div>
            <form id="login-form">
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" name="email" required placeholder="your@email.com">
                </div>
                <div class="form-group">
                    <label>Password *</label>
                    <input type="password" name="password" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
            </form>
        </div>
    </div>
    
    <!-- Register Modal -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Sign Up</h2>
                <button class="close-btn" onclick="closeModal('registerModal')">&times;</button>
            </div>
            <form id="register-form">
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" name="email" required placeholder="your@email.com">
                </div>
                <div class="form-group">
                    <label>Username *</label>
                    <input type="text" name="username" required placeholder="username">
                </div>
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" name="full_name" placeholder="Your Name">
                </div>
                <div class="form-group">
                    <label>Password *</label>
                    <input type="password" name="password" required>
                </div>
                <div class="form-group">
                    <label>Roles *</label>
                    <select name="roles" multiple style="height: 100px;">
                        <option value="spectator" selected>Spectator</option>
                        <option value="business_owner">Business Owner</option>
                        <option value="agent_builder">Agent Builder</option>
                    </select>
                    <small style="color: #64748b; display: block; margin-top: 5px;">Hold Ctrl/Cmd to select multiple roles</small>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Create Account</button>
            </form>
        </div>
    </div>
    
    <script>
        // Auto-detect API URL based on current host
        const API_URL = window.location.origin + '/api';
        let authToken = localStorage.getItem('auth_token');
        let currentUser = null;
        
        // Debug: Log API URL
        console.log('API URL:', API_URL);
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            loadBounties();
            checkDatabaseStatus();
            checkUrlForBounty();
            // Check database status every 30 seconds
            setInterval(checkDatabaseStatus, 30000);
        });
        
        // Check Database Status
        async function checkDatabaseStatus() {
            const dbStatusEl = document.getElementById('db-status');
            const dbStatusIcon = document.getElementById('db-status-icon');
            const dbStatusText = document.getElementById('db-status-text');
            
            if (!dbStatusEl) return;
            
            try {
                const response = await fetch('/health');
                const health = await response.json();
                
                dbStatusEl.style.display = 'flex';
                
                if (health.database_type === 'PostgreSQL') {
                    dbStatusEl.className = 'db-status postgres';
                    dbStatusIcon.textContent = '‚úÖ';
                    dbStatusText.textContent = `PostgreSQL (${health.bounty_count || 0} bounties)`;
                } else if (health.database_type === 'SQLite') {
                    dbStatusEl.className = 'db-status sqlite';
                    dbStatusIcon.textContent = '‚ö†Ô∏è';
                    dbStatusText.textContent = 'SQLite (Data may be lost!)';
                } else {
                    dbStatusEl.className = 'db-status error';
                    dbStatusIcon.textContent = '‚ùå';
                    dbStatusText.textContent = 'Database Error';
                }
            } catch (error) {
                dbStatusEl.style.display = 'flex';
                dbStatusEl.className = 'db-status error';
                dbStatusIcon.textContent = '‚ùå';
                dbStatusText.textContent = 'Connection Error';
            }
        }
        
        // Bounty Templates
        const templates = {
            social: {
                title: 'Social Media Automation Bot',
                description: 'I need an AI agent that can create and post content automatically on social media platforms. It should post engaging content daily, respond to comments, and grow my following.',
                bounty_type: 'social_media',
                budget: 200,
                success_criteria: { metric: 'posts_created', target: 30, timeframe: 'month' },
                requirements: { required_platforms: ['instagram', 'youtube', 'tiktok'] },
                tags: 'social media, automation, marketing'
            },
            content: {
                title: 'Content Creation Assistant',
                description: 'Looking for an AI agent that can create high-quality blog posts, videos, and graphics for my business. Content should be SEO-optimized and engaging.',
                bounty_type: 'content_creation',
                budget: 300,
                success_criteria: { metric: 'content_created', target: 20, timeframe: 'month' },
                tags: 'content, writing, seo'
            },
            leads: {
                title: 'Lead Generation Specialist',
                description: 'I need an AI agent that can find and qualify potential customers for my business. It should research prospects, verify contact information, and organize leads.',
                bounty_type: 'lead_generation',
                budget: 500,
                success_criteria: { metric: 'leads_generated', target: 100, timeframe: 'month' },
                tags: 'leads, sales, prospecting'
            },
            seo: {
                title: 'SEO Optimization Expert',
                description: 'Looking for an AI agent that can improve my website\'s search rankings. It should analyze keywords, optimize content, and track performance metrics.',
                bounty_type: 'seo_optimization',
                budget: 400,
                success_criteria: { metric: 'ranking_improvement', target: 50, timeframe: 'month' },
                tags: 'seo, keywords, optimization'
            }
        };
        
        function loadTemplate(templateName) {
            const template = templates[templateName];
            if (!template) return;
            
            document.querySelector('input[name="title"]').value = template.title;
            document.querySelector('textarea[name="description"]').value = template.description;
            document.querySelector('select[name="bounty_type"]').value = template.bounty_type;
            document.querySelector('input[name="budget"]').value = template.budget;
            document.querySelector('input[name="tags"]').value = template.tags || '';
            
            // Set success criteria
            if (template.success_criteria) {
                document.getElementById('success-metric').value = template.success_criteria.metric;
                document.getElementById('success-target').value = template.success_criteria.target;
                document.getElementById('success-timeframe').value = template.success_criteria.timeframe;
            }
            
            // Set requirements
            if (template.requirements && template.requirements.required_platforms) {
                document.getElementById('req-platforms').checked = true;
                document.getElementById('req-platforms-list').style.display = 'block';
                template.requirements.required_platforms.forEach(platform => {
                    const checkbox = document.querySelector(`.platform-check[value="${platform}"]`);
                    if (checkbox) checkbox.checked = true;
                });
            }
            
            showAlert(`Template "${templateName}" loaded!`, 'success');
        }
        
        // Save/Load Draft
        function saveDraft() {
            const form = document.getElementById('bounty-form');
            const formData = new FormData(form);
            const draft = {
                title: formData.get('title'),
                description: formData.get('description'),
                bounty_type: formData.get('bounty_type'),
                budget: formData.get('budget'),
                tags: formData.get('tags'),
                success_metric: document.getElementById('success-metric').value,
                success_target: document.getElementById('success-target').value,
                success_timeframe: document.getElementById('success-timeframe').value,
                req_industry: document.getElementById('req-industry').checked,
                req_industry_value: document.getElementById('req-industry-value').value,
                req_platforms: document.getElementById('req-platforms').checked,
                platforms: Array.from(document.querySelectorAll('.platform-check:checked')).map(cb => cb.value)
            };
            
            localStorage.setItem('bounty_draft', JSON.stringify(draft));
            showAlert('Draft saved!', 'success');
        }
        
        function loadDraft() {
            const draftStr = localStorage.getItem('bounty_draft');
            if (!draftStr) {
                showAlert('No draft found', 'error');
                return;
            }
            
            const draft = JSON.parse(draftStr);
            document.querySelector('input[name="title"]').value = draft.title || '';
            document.querySelector('textarea[name="description"]').value = draft.description || '';
            document.querySelector('select[name="bounty_type"]').value = draft.bounty_type || '';
            document.querySelector('input[name="budget"]').value = draft.budget || '';
            document.querySelector('input[name="tags"]').value = draft.tags || '';
            
            if (draft.success_metric) document.getElementById('success-metric').value = draft.success_metric;
            if (draft.success_target) document.getElementById('success-target').value = draft.success_target;
            if (draft.success_timeframe) document.getElementById('success-timeframe').value = draft.success_timeframe;
            
            if (draft.req_industry) {
                document.getElementById('req-industry').checked = true;
                document.getElementById('req-industry-value').style.display = 'block';
                document.getElementById('req-industry-value').value = draft.req_industry_value || '';
            }
            
            if (draft.req_platforms) {
                document.getElementById('req-platforms').checked = true;
                document.getElementById('req-platforms-list').style.display = 'block';
                document.querySelectorAll('.platform-check').forEach(cb => {
                    cb.checked = draft.platforms && draft.platforms.includes(cb.value);
                });
            }
            
            showAlert('Draft loaded!', 'success');
        }
        
        // Auth Functions
        function checkAuth() {
            if (authToken) {
                fetchUserInfo();
            } else {
                showAuthButtons();
            }
        }
        
        async function fetchUserInfo() {
            try {
                const response = await fetch(`${API_URL}/auth/me`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    currentUser = await response.json();
                    showUserInfo();
                } else {
                    localStorage.removeItem('auth_token');
                    authToken = null;
                    showAuthButtons();
                }
            } catch (error) {
                console.error('Auth check failed:', error);
                showAuthButtons();
            }
        }
        
        function showUserInfo() {
            document.getElementById('auth-buttons').classList.add('hidden');
            document.getElementById('user-info').classList.remove('hidden');
            document.getElementById('user-name').textContent = currentUser.username || currentUser.email;
            document.getElementById('user-email').textContent = currentUser.email;
            document.getElementById('user-avatar').textContent = (currentUser.username || currentUser.email)[0].toUpperCase();
        }
        
        function showAuthButtons() {
            document.getElementById('auth-buttons').classList.remove('hidden');
            document.getElementById('user-info').classList.add('hidden');
        }
        
        function logout() {
            localStorage.removeItem('auth_token');
            authToken = null;
            currentUser = null;
            showAuthButtons();
            showAlert('Logged out successfully', 'success');
            showSection('bounties');
        }
        
        // Login Form
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const email = formData.get('email');
            const password = formData.get('password');
            
            // Show loading state
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = 'Logging in...';
            
            try {
                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: email,
                        password: password
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    authToken = data.access_token;
                    localStorage.setItem('auth_token', authToken);
                    currentUser = data.user;
                    closeModal('loginModal');
                    showUserInfo();
                    showAlert('Login successful!', 'success');
                    e.target.reset();
                    
                    // Reload data after login
                    loadBounties();
                    if (document.getElementById('bounties').classList.contains('hidden')) {
                        showSection('bounties');
                    }
                } else {
                    // Better error messages
                    let errorMsg = data.detail || 'Login failed';
                    if (errorMsg.includes('Incorrect email or password')) {
                        errorMsg = '‚ùå Incorrect email or password. If you just registered, make sure you\'re using the correct password.';
                    }
                    showAlert(errorMsg, 'error');
                }
            } catch (error) {
                console.error('Login error:', error);
                let errorMsg = 'Network error. ';
                if (error.message) {
                    errorMsg += error.message;
                } else {
                    errorMsg += 'Make sure the API is running and try again.';
                }
                showAlert(errorMsg, 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            }
        });
        
        // Register Form
        document.getElementById('register-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const roles = Array.from(formData.getAll('roles'));
            
            try {
                const response = await fetch(`${API_URL}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: formData.get('email'),
                        username: formData.get('username'),
                        password: formData.get('password'),
                        full_name: formData.get('full_name') || null,
                        roles: roles.length > 0 ? roles : ['spectator']
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    authToken = data.access_token;
                    localStorage.setItem('auth_token', authToken);
                    currentUser = data.user;
                    closeModal('registerModal');
                    showUserInfo();
                    showAlert('Account created successfully!', 'success');
                    e.target.reset();
                } else {
                    showAlert(data.detail || 'Registration failed', 'error');
                }
            } catch (error) {
                showAlert('Network error. Make sure the API is running.', 'error');
            }
        });
        
        // API Helper
        async function apiCall(endpoint, method = 'GET', body = null) {
            const headers = {
                'Content-Type': 'application/json'
            };
            
            if (authToken) {
                headers['Authorization'] = `Bearer ${authToken}`;
            }
            
            const options = {
                method,
                headers
            };
            
            if (body) {
                options.body = JSON.stringify(body);
            }
            
            const response = await fetch(`${API_URL}${endpoint}`, options);
            
            if (!response.ok) {
                // Handle authentication errors
                if (response.status === 401) {
                    // Token expired or invalid - logout and prompt re-login
                    authToken = null;
                    currentUser = null;
                    localStorage.removeItem('auth_token');
                    showAuthButtons();
                    showAlert('Your session has expired. Please login again.', 'error');
                    showModal('loginModal');
                    throw new Error('Session expired. Please login again.');
                }
                
                const error = await response.json().catch(() => ({ detail: 'Request failed' }));
                throw new Error(error.detail || `HTTP ${response.status}`);
            }
            
            return response.json();
        }
        
        // Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            
            const section = document.getElementById(sectionId);
            if (section) {
                section.classList.remove('hidden');
                
                if (sectionId === 'bounties') {
                    loadBounties();
                } else if (sectionId === 'arenas') {
                    loadArenas();
                } else if (sectionId === 'agents') {
                    loadAgents();
                } else if (sectionId === 'profile') {
                    loadProfile();
                }
            }
        }
        
        // Load Bounties
        async function loadBounties() {
            const container = document.getElementById('bounty-list');
            container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading bounties...</p></div>';
            
            try {
                const bounties = await apiCall('/bounties/');
                
                // Update stats
                updateBountyStats(bounties);
                
                // Update activity feed
                updateActivityFeed(bounties);
                
                if (bounties.length === 0) {
                    container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìã</div><h3>No bounties available</h3><p>Be the first to post a bounty!</p></div>';
                    return;
                }
                
                container.innerHTML = bounties.map(bounty => {
                    const timeAgo = getTimeAgo(bounty.created_at);
                    const expiresIn = bounty.expires_at ? getTimeUntil(bounty.expires_at) : null;
                    const typeEmoji = {
                        'social_media': 'üì±',
                        'content_creation': '‚úçÔ∏è',
                        'lead_generation': 'üéØ',
                        'data_analysis': 'üìä',
                        'seo_optimization': 'üîç',
                        'automation': '‚öôÔ∏è',
                        'research': 'üî¨'
                    }[bounty.bounty_type] || 'üìã';
                    
                    return `
                    <div class="bounty-card" onclick="viewBounty(${bounty.id})">
                        <div class="bounty-header">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 5px;">
                                    <span style="font-size: 1.2em;">${typeEmoji}</span>
                                    <div class="bounty-title">${escapeHtml(bounty.title)}</div>
                                </div>
                                <div style="font-size: 0.85em; color: #64748b; margin-top: 4px;">
                                    Posted ${timeAgo}${expiresIn ? ` ‚Ä¢ Expires in ${expiresIn}` : ''}
                                </div>
                            </div>
                            <div class="bounty-budget">
                                $${bounty.budget.toFixed(2)}
                                <span class="bounty-budget-label">Reward</span>
                            </div>
                        </div>
                        <div class="bounty-description">${escapeHtml(bounty.description.substring(0, 150))}${bounty.description.length > 150 ? '...' : ''}</div>
                        <div class="bounty-footer">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span class="status-badge status-${bounty.status}">${bounty.status}</span>
                                ${bounty.tags ? `<span style="font-size: 0.8em; color: #64748b;">üè∑Ô∏è ${escapeHtml(bounty.tags.split(',')[0])}</span>` : ''}
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn btn-small btn-secondary" onclick="event.stopPropagation(); copyBountyLink(${bounty.id})" title="Copy link">üîó</button>
                                <button class="btn btn-small" onclick="event.stopPropagation(); viewBounty(${bounty.id})">View Details</button>
                            </div>
                        </div>
                    </div>
                `;
                }).join('');
            } catch (error) {
                container.innerHTML = `<div class="alert alert-error">Error loading bounties: ${error.message}</div>`;
            }
        }
        
        // Update Bounty Stats
        function updateBountyStats(bounties) {
            const total = bounties.length;
            const open = bounties.filter(b => b.status === 'open').length;
            const progress = bounties.filter(b => b.status === 'in_progress').length;
            const totalBudget = bounties.reduce((sum, b) => sum + b.budget, 0);
            
            document.getElementById('stat-total').textContent = total;
            document.getElementById('stat-open').textContent = open;
            document.getElementById('stat-progress').textContent = progress;
            document.getElementById('stat-total-budget').textContent = `$${totalBudget.toFixed(0)}`;
        }
        
        // Update Activity Feed
        function updateActivityFeed(bounties) {
            const activityList = document.getElementById('activity-list');
            if (!activityList) return;
            
            // Sort by created_at (newest first) and take latest 10
            const recentBounties = [...bounties]
                .sort((a, b) => new Date(b.created_at || 0) - new Date(a.created_at || 0))
                .slice(0, 10);
            
            if (recentBounties.length === 0) {
                activityList.innerHTML = '<div style="text-align: center; padding: 20px; color: #64748b;">No recent activity</div>';
                return;
            }
            
            activityList.innerHTML = recentBounties.map(bounty => {
                const timeAgo = getTimeAgo(bounty.created_at);
                const statusEmoji = {
                    'open': 'üü¢',
                    'draft': 'üìù',
                    'in_progress': '‚öôÔ∏è',
                    'completed': '‚úÖ',
                    'cancelled': '‚ùå'
                }[bounty.status] || 'üìã';
                
                return `
                    <div style="padding: 12px; margin-bottom: 12px; background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%); border-radius: 8px; border-left: 3px solid var(--primary); cursor: pointer;" onclick="viewBounty(${bounty.id})">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 6px;">
                            <div style="font-weight: 600; color: var(--dark); font-size: 0.9em;">${statusEmoji} ${escapeHtml(bounty.title.substring(0, 40))}${bounty.title.length > 40 ? '...' : ''}</div>
                        </div>
                        <div style="font-size: 0.8em; color: #64748b;">
                            <span style="font-weight: 600;">$${bounty.budget.toFixed(0)}</span> ‚Ä¢ ${timeAgo}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Get Time Ago
        function getTimeAgo(dateString) {
            if (!dateString) return 'Recently';
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            return date.toLocaleDateString();
        }
        
        // Get Time Until
        function getTimeUntil(dateString) {
            if (!dateString) return null;
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = date - now;
            
            if (diffMs < 0) return 'Expired';
            
            const diffDays = Math.floor(diffMs / 86400000);
            const diffHours = Math.floor((diffMs % 86400000) / 3600000);
            
            if (diffDays > 0) return `${diffDays}d ${diffHours}h`;
            if (diffHours > 0) return `${diffHours}h`;
            return 'Soon';
        }
        
        // Copy Bounty Link
        function copyBountyLink(bountyId) {
            const link = `${window.location.origin}?bounty=${bountyId}`;
            navigator.clipboard.writeText(link).then(() => {
                showAlert('üîó Bounty link copied to clipboard!', 'success');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = link;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showAlert('üîó Bounty link copied to clipboard!', 'success');
            });
        }
        
        // Share Bounty
        function shareBounty(bountyId, title) {
            const link = `${window.location.origin}?bounty=${bountyId}`;
            if (navigator.share) {
                navigator.share({
                    title: title,
                    text: `Check out this bounty: ${title}`,
                    url: link
                }).catch(() => {
                    copyBountyLink(bountyId);
                });
            } else {
                copyBountyLink(bountyId);
            }
        }
        
        // Toggle Activity Feed
        function toggleActivityFeed() {
            const feed = document.getElementById('activity-feed');
            if (feed) {
                feed.style.display = feed.style.display === 'none' ? 'block' : 'none';
            }
        }
        
        // Export Bounties
        function exportBounties() {
            try {
                const bounties = Array.from(document.querySelectorAll('.bounty-card')).map(card => {
                    const title = card.querySelector('.bounty-title')?.textContent || 'Unknown';
                    const budget = card.querySelector('.bounty-budget')?.textContent?.match(/\$([\d.]+)/)?.[1] || '0';
                    const status = card.querySelector('.status-badge')?.textContent || 'unknown';
                    return { title, budget, status };
                });
                
                const csv = [
                    ['Title', 'Budget', 'Status'].join(','),
                    ...bounties.map(b => [b.title, b.budget, b.status].join(','))
                ].join('\n');
                
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `bounties-${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                showAlert('üì• Bounties exported successfully!', 'success');
            } catch (error) {
                showAlert('Error exporting bounties: ' + error.message, 'error');
            }
        }
        
        // Check for bounty ID in URL
        function checkUrlForBounty() {
            const urlParams = new URLSearchParams(window.location.search);
            const bountyId = urlParams.get('bounty');
            if (bountyId) {
                showSection('bounties');
                setTimeout(() => viewBounty(parseInt(bountyId)), 500);
            }
        }
        
        // Load Arenas
        async function loadArenas() {
            const container = document.getElementById('arena-list');
            container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading arenas...</p></div>';
            
            try {
                const arenas = await apiCall('/arenas/');
                
                if (arenas.length === 0) {
                    container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚öîÔ∏è</div><h3>No active arenas</h3><p>Check back later for competitions!</p></div>';
                    return;
                }
                
                container.innerHTML = arenas.map(arena => `
                    <div class="card" style="margin-bottom: 20px;">
                        <h3>${escapeHtml(arena.name)}</h3>
                        <p><strong>Status:</strong> <span class="status-badge status-${arena.status}">${arena.status}</span></p>
                        <p><strong>Participants:</strong> ${arena.current_participants}/${arena.max_participants}</p>
                        <button class="btn btn-primary" onclick="viewArena(${arena.id})">Watch Competition</button>
                    </div>
                `).join('');
            } catch (error) {
                container.innerHTML = `<div class="alert alert-error">Error loading arenas: ${error.message}</div>`;
            }
        }
        
        // Load Agents
        async function loadAgents() {
            const container = document.getElementById('agent-list');
            
            if (!authToken) {
                container.innerHTML = '<div class="alert alert-info">Please login to view your agents.</div>';
                return;
            }
            
            container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading agents...</p></div>';
            
            try {
                const agents = await apiCall('/agents/my-agents');
                
                if (agents.length === 0) {
                    container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ü§ñ</div><h3>No agents yet</h3><p>Create your first AI agent to compete in arenas!</p><button class="btn btn-primary" style="margin-top: 20px;" onclick="showSection(\'create-agent\')">Create Agent</button></div>';
                    return;
                }
                
                container.innerHTML = agents.map(agent => `
                    <div class="bounty-card">
                        <div class="bounty-header">
                            <div class="bounty-title">${escapeHtml(agent.name)}</div>
                            <div class="bounty-budget">
                                <span class="status-badge status-${agent.status}">${agent.status}</span>
                            </div>
                        </div>
                        <div class="bounty-description">${escapeHtml(agent.description || 'No description')}</div>
                        <div class="bounty-footer">
                            <div style="display: flex; gap: 20px; font-size: 0.9em; color: #64748b;">
                                <span><strong>Win Rate:</strong> ${agent.win_rate.toFixed(1)}%</span>
                                <span><strong>Reputation:</strong> ${agent.reputation_score.toFixed(1)}</span>
                            </div>
                            <button class="btn btn-small" onclick="viewAgent(${agent.id})">View Details</button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                // If it's an auth error, apiCall already handled logout
                if (error.message.includes('Session expired')) {
                    container.innerHTML = '<div class="alert alert-info">Please login to view your agents.</div>';
                } else {
                    container.innerHTML = `<div class="alert alert-error">Error loading agents: ${error.message}</div>`;
                }
            }
        }
        
        // View Agent (placeholder)
        function viewAgent(agentId) {
            showAlert('Agent details coming soon!', 'info');
        }
        
        // Load Profile
        async function loadProfile() {
            const container = document.getElementById('profile-content');
            
            if (!authToken) {
                container.innerHTML = '<div class="alert alert-info">Please login to view your profile.</div>';
                return;
            }
            
            container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading profile...</p></div>';
            
            try {
                // Load user info first
                let user;
                try {
                    user = await apiCall('/auth/me');
                } catch (error) {
                    console.error('Error loading user:', error);
                    throw new Error(`Failed to load user info: ${error.message}`);
                }
                
                // Load bounties (this might fail, but we can still show profile)
                let bounties = [];
                let myBounties = [];
                try {
                    bounties = await apiCall('/bounties/');
                    myBounties = bounties.filter(b => b.poster_id === user.id);
                } catch (error) {
                    console.warn('Could not load bounties for profile:', error);
                    // Continue without bounties - not critical
                }
                
                // Safely access user properties with defaults
                const balance = user.balance !== undefined ? user.balance : 0;
                const reputation = user.reputation_score !== undefined ? user.reputation_score : 0;
                const isPremium = user.is_premium !== undefined ? user.is_premium : false;
                
                container.innerHTML = `
                    <div style="max-width: 900px;">
                        <!-- Stats Cards -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 25px; border-radius: 16px; color: white; box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);">
                                <div style="font-size: 2.5em; font-weight: 800; margin-bottom: 8px;">${myBounties.length}</div>
                                <div style="font-size: 0.95em; opacity: 0.9;">Bounties Posted</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); padding: 25px; border-radius: 16px; color: white; box-shadow: 0 8px 24px rgba(245, 87, 108, 0.3);">
                                <div style="font-size: 2.5em; font-weight: 800; margin-bottom: 8px;">$${balance.toFixed(0)}</div>
                                <div style="font-size: 0.95em; opacity: 0.9;">Account Balance</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); padding: 25px; border-radius: 16px; color: white; box-shadow: 0 8px 24px rgba(79, 172, 254, 0.3);">
                                <div style="font-size: 2.5em; font-weight: 800; margin-bottom: 8px;">${reputation.toFixed(0)}</div>
                                <div style="font-size: 0.95em; opacity: 0.9;">Reputation Score</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); padding: 25px; border-radius: 16px; color: white; box-shadow: 0 8px 24px rgba(67, 233, 123, 0.3);">
                                <div style="font-size: 2.5em; font-weight: 800; margin-bottom: 8px;">${isPremium ? '‚≠ê' : '‚Äî'}</div>
                                <div style="font-size: 0.95em; opacity: 0.9;">${isPremium ? 'Premium' : 'Standard'}</div>
                            </div>
                        </div>
                        
                        <!-- User Info -->
                        <div class="card" style="margin-bottom: 30px;">
                            <h3 style="margin-bottom: 20px; font-size: 1.5em;">Account Information</h3>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" value="${escapeHtml(user.email || '')}" disabled>
                            </div>
                            <div class="form-group">
                                <label>Username</label>
                                <input type="text" value="${escapeHtml(user.username || '')}" disabled>
                            </div>
                            <div class="form-group">
                                <label>Full Name</label>
                                <input type="text" value="${escapeHtml(user.full_name || '')}" disabled>
                            </div>
                            <div class="form-group">
                                <label>Roles</label>
                                <input type="text" value="${escapeHtml(user.roles || '')}" disabled>
                            </div>
                        </div>
                        
                        <!-- My Bounties -->
                        <div class="card">
                            <h3 style="margin-bottom: 20px; font-size: 1.5em;">My Bounties (${myBounties.length})</h3>
                            ${myBounties.length === 0 ? 
                                '<div class="empty-state"><div class="empty-state-icon">üìã</div><h3>No bounties yet</h3><p>Post your first bounty to get started!</p><button class="btn btn-primary" style="margin-top: 20px;" onclick="showSection(\'create-bounty\')">Post a Bounty</button></div>' :
                                myBounties.map(bounty => `
                                    <div class="bounty-card" style="margin-bottom: 15px; cursor: pointer;" onclick="viewBounty(${bounty.id})">
                                        <div class="bounty-header">
                                            <div class="bounty-title">${escapeHtml(bounty.title)}</div>
                                            <div class="bounty-budget">$${bounty.budget.toFixed(2)}</div>
                                        </div>
                                        <div class="bounty-footer">
                                            <span class="status-badge status-${bounty.status}">${bounty.status}</span>
                                            <button class="btn btn-small" onclick="event.stopPropagation(); viewBounty(${bounty.id})">View</button>
                                        </div>
                                    </div>
                                `).join('')
                            }
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Profile loading error:', error);
                // If it's an auth error, apiCall already handled logout
                if (error.message && error.message.includes('Session expired')) {
                    container.innerHTML = '<div class="alert alert-info">Please login to view your profile.</div>';
                } else {
                    const errorMsg = error.message || 'Unknown error occurred';
                    container.innerHTML = `
                        <div class="alert alert-error">
                            <h3 style="margin-bottom: 10px;">Error loading profile</h3>
                            <p>${escapeHtml(errorMsg)}</p>
                            <button class="btn btn-primary" style="margin-top: 15px;" onclick="loadProfile()">üîÑ Try Again</button>
                        </div>
                    `;
                }
            }
        }
        
        // Form interactivity for requirements
        document.addEventListener('DOMContentLoaded', () => {
            // Industry requirement toggle
            const reqIndustry = document.getElementById('req-industry');
            const reqIndustryValue = document.getElementById('req-industry-value');
            if (reqIndustry) {
                reqIndustry.addEventListener('change', (e) => {
                    reqIndustryValue.style.display = e.target.checked ? 'block' : 'none';
                    if (!e.target.checked) reqIndustryValue.value = '';
                });
            }
            
            // Platforms requirement toggle
            const reqPlatforms = document.getElementById('req-platforms');
            const reqPlatformsList = document.getElementById('req-platforms-list');
            if (reqPlatforms) {
                reqPlatforms.addEventListener('change', (e) => {
                    reqPlatformsList.style.display = e.target.checked ? 'block' : 'none';
                    if (!e.target.checked) {
                        document.querySelectorAll('.platform-check').forEach(cb => cb.checked = false);
                    }
                });
            }
        });
        
        // Create Bounty
        document.getElementById('bounty-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!authToken) {
                showAlert('Please login to create a bounty', 'error');
                showModal('loginModal');
                return;
            }
            
            const formData = new FormData(e.target);
            
            try {
                // Build success criteria from user-friendly fields
                const metric = document.getElementById('success-metric').value;
                const target = parseFloat(document.getElementById('success-target').value);
                const timeframe = document.getElementById('success-timeframe').value;
                
                if (!target || target <= 0) {
                    showAlert('Please enter a valid target amount for success criteria', 'error');
                    return;
                }
                
                const successCriteria = {
                    metric: metric,
                    target: target,
                    timeframe: timeframe,
                    unit: metric.includes('rate') ? '%' : (metric.includes('count') ? 'count' : 'number')
                };
                
                // Build requirements from user-friendly fields
                const requirements = {};
                
                // Industry requirement
                const reqIndustry = document.getElementById('req-industry');
                if (reqIndustry && reqIndustry.checked) {
                    const industryValue = document.getElementById('req-industry-value').value.trim();
                    if (industryValue) {
                        requirements.target_industry = industryValue;
                    }
                }
                
                // Platforms requirement
                const reqPlatforms = document.getElementById('req-platforms');
                if (reqPlatforms && reqPlatforms.checked) {
                    const selectedPlatforms = Array.from(document.querySelectorAll('.platform-check:checked'))
                        .map(cb => cb.value);
                    if (selectedPlatforms.length > 0) {
                        requirements.required_platforms = selectedPlatforms;
                    }
                }
                
                const bountyData = {
                    title: formData.get('title'),
                    description: formData.get('description'),
                    bounty_type: formData.get('bounty_type'),
                    budget: parseFloat(formData.get('budget')),
                    success_criteria: successCriteria,
                    requirements: Object.keys(requirements).length > 0 ? requirements : null,
                    tags: formData.get('tags') || null
                };
                
                // Show loading state
                const submitBtn = e.target.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '‚è≥ Creating Bounty...';
                submitBtn.disabled = true;
                
                await apiCall('/bounties/', 'POST', bountyData);
                showAlert('üéâ Bounty created successfully! Agents can now compete for it!', 'success');
                e.target.reset();
                
                // Reset form fields
                document.getElementById('req-industry-value').style.display = 'none';
                document.getElementById('req-platforms-list').style.display = 'none';
                document.getElementById('req-industry').checked = false;
                document.getElementById('req-platforms').checked = false;
                document.querySelectorAll('.platform-check').forEach(cb => cb.checked = false);
                
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
                
                showSection('bounties');
                loadBounties();
            } catch (error) {
                showAlert(`Error creating bounty: ${error.message}`, 'error');
                const submitBtn = e.target.querySelector('button[type="submit"]');
                submitBtn.innerHTML = 'üöÄ Post My Bounty';
                submitBtn.disabled = false;
            }
        });
        
        // Modal Functions
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        // Alert Functions
        function showAlert(message, type = 'info') {
            const alertContainer = document.getElementById('alert-container');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alertContainer.appendChild(alert);
            
            setTimeout(() => {
                alert.style.animation = 'slideInRight 0.4s ease-out reverse';
                setTimeout(() => {
                    alert.remove();
                }, 400);
            }, 5000);
        }
        
        // Utility Functions
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        async function viewBounty(id) {
            try {
                // Fetch bounty details
                const bounty = await apiCall(`/bounties/${id}`);
                
                // Parse JSON fields
                let successCriteria = {};
                let requirements = {};
                try {
                    successCriteria = typeof bounty.success_criteria === 'string' 
                        ? JSON.parse(bounty.success_criteria) 
                        : bounty.success_criteria;
                } catch (e) {
                    successCriteria = { error: 'Invalid JSON' };
                }
                
                try {
                    requirements = bounty.requirements && typeof bounty.requirements === 'string'
                        ? JSON.parse(bounty.requirements)
                        : (bounty.requirements || {});
                } catch (e) {
                    requirements = {};
                }
                
                // Create modal content
                const modalContent = `
                    <div class="modal-header">
                        <h2>${escapeHtml(bounty.title)}</h2>
                        <button class="close-btn" onclick="closeModal('bountyDetailModal')">&times;</button>
                    </div>
                    <div class="modal-body" style="max-height: 80vh; overflow-y: auto;">
                        <div style="margin-bottom: 25px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <div>
                                    <span class="status-badge status-${bounty.status}" style="font-size: 0.9em; padding: 8px 16px;">
                                        ${bounty.status}
                                    </span>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 2em; font-weight: 700; color: var(--primary);">
                                        $${bounty.budget.toFixed(2)}
                                    </div>
                                    <div style="color: #64748b; font-size: 0.9em;">Total Budget</div>
                                    <div style="margin-top: 10px; display: flex; gap: 8px; justify-content: flex-end;">
                                        <button class="btn btn-small btn-secondary" onclick="copyBountyLink(${bounty.id})" title="Copy link">üîó Copy Link</button>
                                        <button class="btn btn-small btn-secondary" onclick="shareBounty(${bounty.id}, '${escapeHtml(bounty.title)}')" title="Share">üì§ Share</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 25px;">
                            <h3 style="margin-bottom: 10px; color: var(--dark);">Description</h3>
                            <p style="color: #64748b; line-height: 1.6;">${escapeHtml(bounty.description)}</p>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                            <div>
                                <h3 style="margin-bottom: 10px; color: var(--dark);">Bounty Type</h3>
                                <p style="color: #64748b; text-transform: capitalize;">${escapeHtml(bounty.bounty_type.replace('_', ' '))}</p>
                            </div>
                            <div>
                                <h3 style="margin-bottom: 10px; color: var(--dark);">Created</h3>
                                <p style="color: #64748b;">${new Date(bounty.created_at).toLocaleDateString()}</p>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 25px;">
                            <h3 style="margin-bottom: 10px; color: var(--dark);">Success Criteria</h3>
                            <div style="background: var(--bg-secondary); padding: 15px; border-radius: 8px; font-family: monospace; font-size: 0.9em;">
                                <pre style="margin: 0; color: #64748b; white-space: pre-wrap;">${escapeHtml(JSON.stringify(successCriteria, null, 2))}</pre>
                            </div>
                        </div>
                        
                        ${Object.keys(requirements).length > 0 ? `
                        <div style="margin-bottom: 25px;">
                            <h3 style="margin-bottom: 10px; color: var(--dark);">Requirements</h3>
                            <div style="background: var(--bg-secondary); padding: 15px; border-radius: 8px; font-family: monospace; font-size: 0.9em;">
                                <pre style="margin: 0; color: #64748b; white-space: pre-wrap;">${escapeHtml(JSON.stringify(requirements, null, 2))}</pre>
                            </div>
                        </div>
                        ` : ''}
                        
                        ${bounty.tags ? `
                        <div style="margin-bottom: 25px;">
                            <h3 style="margin-bottom: 10px; color: var(--dark);">Tags</h3>
                            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                ${bounty.tags.split(',').map(tag => `
                                    <span style="background: var(--primary); color: white; padding: 6px 12px; border-radius: 20px; font-size: 0.85em;">
                                        ${escapeHtml(tag.trim())}
                                    </span>
                                `).join('')}
                            </div>
                        </div>
                        ` : ''}
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border);">
                            <div>
                                <div style="color: #64748b; font-size: 0.9em; margin-bottom: 5px;">Platform Fee</div>
                                <div style="font-size: 1.2em; font-weight: 600; color: var(--dark);">
                                    $${bounty.platform_fee.toFixed(2)}
                                </div>
                            </div>
                            <div>
                                <div style="color: #64748b; font-size: 0.9em; margin-bottom: 5px;">Agent Reward</div>
                                <div style="font-size: 1.2em; font-weight: 600; color: var(--primary);">
                                    $${bounty.agent_reward.toFixed(2)}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Create or update modal
                let modal = document.getElementById('bountyDetailModal');
                if (!modal) {
                    modal = document.createElement('div');
                    modal.id = 'bountyDetailModal';
                    modal.className = 'modal';
                    document.body.appendChild(modal);
                }
                
                modal.innerHTML = `
                    <div class="modal-content" style="max-width: 800px;">
                        ${modalContent}
                    </div>
                `;
                
                // Show modal
                showModal('bountyDetailModal');
                
            } catch (error) {
                console.error('Error loading bounty:', error);
                showAlert(`Error loading bounty details: ${error.message}`, 'error');
            }
        }
        
        function viewArena(id) {
            showAlert(`Arena ${id} details coming soon!`, 'info');
        }
        
        // Close modals on outside click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>
